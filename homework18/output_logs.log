root@evengtest:/home/eve/homework18# vagrant status
Current machine states:

borgs                     not created (virtualbox)
borgc                     not created (virtualbox)

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run `vagrant status NAME`.
root@evengtest:/home/eve/homework18# 
root@evengtest:/home/eve/homework18# vagrant up
Bringing machine 'borgs' up with 'virtualbox' provider...
Bringing machine 'borgc' up with 'virtualbox' provider...
==> borgs: Importing base box 'ubuntu/jammy64'...
==> borgs: Matching MAC address for NAT networking...
==> borgs: Setting the name of the VM: homework18_borgs_1727845731446_64236
==> borgs: Clearing any previously set network interfaces...
==> borgs: Preparing network interfaces based on configuration...
    borgs: Adapter 1: nat
    borgs: Adapter 2: hostonly
==> borgs: Forwarding ports...
    borgs: 22 (guest) => 2222 (host) (adapter 1)
==> borgs: Configuring storage mediums...
    borgs: Disk 'backup_disk' not found in guest. Creating and attaching disk to guest...
==> borgs: Running 'pre-boot' VM customizations...
==> borgs: Booting VM...
==> borgs: Waiting for machine to boot. This may take a few minutes...
    borgs: SSH address: 127.0.0.1:2222
    borgs: SSH username: vagrant
    borgs: SSH auth method: private key
    borgs: Warning: Connection reset. Retrying...
    borgs: Warning: Connection reset. Retrying...
    borgs: 
    borgs: Vagrant insecure key detected. Vagrant will automatically replace
    borgs: this with a newly generated keypair for better security.
    borgs: 
    borgs: Inserting generated public key within guest...
    borgs: Removing insecure key from the guest if it's present...
    borgs: Key inserted! Disconnecting and reconnecting using new SSH key...
==> borgs: Machine booted and ready!
==> borgs: Checking for guest additions in VM...
    borgs: The guest additions on this VM do not match the installed version of
    borgs: VirtualBox! In most cases this is fine, but in rare cases it can
    borgs: prevent things such as shared folders from working properly. If you see
    borgs: shared folder errors, please make sure the guest additions within the
    borgs: virtual machine match the version of VirtualBox you have installed on
    borgs: your host and reload your VM.
    borgs: 
    borgs: Guest Additions Version: 6.0.0 r127566
    borgs: VirtualBox Version: 6.1
==> borgs: Setting hostname...
==> borgs: Configuring and enabling network interfaces...
==> borgs: Running provisioner: shell...
    borgs: Running: inline script
==> borgc: Importing base box 'ubuntu/jammy64'...
==> borgc: Matching MAC address for NAT networking...
==> borgc: Setting the name of the VM: homework18_borgc_1727845889444_13497
==> borgc: Fixed port collision for 22 => 2222. Now on port 2200.
==> borgc: Clearing any previously set network interfaces...
==> borgc: Preparing network interfaces based on configuration...
    borgc: Adapter 1: nat
    borgc: Adapter 2: hostonly
==> borgc: Forwarding ports...
    borgc: 22 (guest) => 2200 (host) (adapter 1)
==> borgc: Running 'pre-boot' VM customizations...
==> borgc: Booting VM...
==> borgc: Waiting for machine to boot. This may take a few minutes...
    borgc: SSH address: 127.0.0.1:2200
    borgc: SSH username: vagrant
    borgc: SSH auth method: private key
    borgc: Warning: Connection reset. Retrying...
    borgc: Warning: Remote connection disconnect. Retrying...
    borgc: Warning: Connection reset. Retrying...
    borgc: Warning: Remote connection disconnect. Retrying...
    borgc: 
    borgc: Vagrant insecure key detected. Vagrant will automatically replace
    borgc: this with a newly generated keypair for better security.
    borgc: 
    borgc: Inserting generated public key within guest...
    borgc: Removing insecure key from the guest if it's present...
    borgc: Key inserted! Disconnecting and reconnecting using new SSH key...
==> borgc: Machine booted and ready!
==> borgc: Checking for guest additions in VM...
    borgc: The guest additions on this VM do not match the installed version of
    borgc: VirtualBox! In most cases this is fine, but in rare cases it can
    borgc: prevent things such as shared folders from working properly. If you see
    borgc: shared folder errors, please make sure the guest additions within the
    borgc: virtual machine match the version of VirtualBox you have installed on
    borgc: your host and reload your VM.
    borgc: 
    borgc: Guest Additions Version: 6.0.0 r127566
    borgc: VirtualBox Version: 6.1
==> borgc: Setting hostname...
==> borgc: Configuring and enabling network interfaces...
==> borgc: Running provisioner: shell...
    borgc: Running: inline script
==> borgc: Running provisioner: ansible...
    borgc: Running ansible-playbook...

PLAY [Time configuration] ******************************************************

TASK [Gathering Facts] *********************************************************
ok: [borgc]
ok: [borgs]

TASK [set timezone] ************************************************************
changed: [borgc]
changed: [borgs]

TASK [timesync-status] *********************************************************
changed: [borgs]
changed: [borgc]

TASK [debug] *******************************************************************
ok: [borgc] => {
    "results.stdout_lines": [
        "       Server: 185.125.190.58 (ntp.ubuntu.com)",
        "Poll interval: 1min 4s (min: 32s; max 34min 8s)",
        "         Leap: normal",
        "      Version: 4",
        "      Stratum: 2",
        "    Reference: C944586A",
        "    Precision: 1us (-25)",
        "Root distance: 716us (max: 5s)",
        "       Offset: -3.733ms",
        "        Delay: 79.101ms",
        "       Jitter: 1.411ms",
        " Packet count: 2",
        "    Frequency: +0.000ppm"
    ]
}
ok: [borgs] => {
    "results.stdout_lines": [
        "       Server: 185.125.190.56 (ntp.ubuntu.com)",
        "Poll interval: 2min 8s (min: 32s; max 34min 8s)",
        "         Leap: normal",
        "      Version: 4",
        "      Stratum: 2",
        "    Reference: 4FF33C32",
        "    Precision: 1us (-25)",
        "Root distance: 762us (max: 5s)",
        "       Offset: +2.190ms",
        "        Delay: 71.552ms",
        "       Jitter: 4.936ms",
        " Packet count: 3",
        "    Frequency: +8.555ppm"
    ]
}

TASK [print timedatectl] *******************************************************
changed: [borgc]
changed: [borgs]

TASK [debug] *******************************************************************
ok: [borgc] => {
    "results.stdout_lines": [
        "               Local time: Wed 2024-10-02 10:13:58 +05",
        "           Universal time: Wed 2024-10-02 05:13:58 UTC",
        "                 RTC time: Wed 2024-10-02 05:13:38",
        "                Time zone: Asia/Yekaterinburg (+05, +0500)",
        "System clock synchronized: yes",
        "              NTP service: active",
        "          RTC in local TZ: no"
    ]
}
ok: [borgs] => {
    "results.stdout_lines": [
        "               Local time: Wed 2024-10-02 10:13:58 +05",
        "           Universal time: Wed 2024-10-02 05:13:58 UTC",
        "                 RTC time: Wed 2024-10-02 05:14:25",
        "                Time zone: Asia/Yekaterinburg (+05, +0500)",
        "System clock synchronized: yes",
        "              NTP service: active",
        "          RTC in local TZ: no"
    ]
}

TASK [print date] **************************************************************
changed: [borgc]
changed: [borgs]

TASK [debug] *******************************************************************
ok: [borgc] => {
    "results.stdout_lines": [
        "Wed Oct  2 10:13:59 AM +05 2024"
    ]
}
ok: [borgs] => {
    "results.stdout_lines": [
        "Wed Oct  2 10:14:00 AM +05 2024"
    ]
}

PLAY [ssh keygen end copy on client] *******************************************

TASK [Gathering Facts] *********************************************************
ok: [borgc]

TASK [ssh keygen rsa] **********************************************************
changed: [borgc]

TASK [copy pub keys file on local vm] ******************************************
changed: [borgc]

TASK [add server-backup to /.ssh/known_hosts] **********************************
changed: [borgc]

TASK [restart ssh] *************************************************************
changed: [borgc]

PLAY [Install and config borg to backup server] ********************************

TASK [Gathering Facts] *********************************************************
ok: [borgs]

TASK [Install borgbackup] ******************************************************
changed: [borgs]

TASK [Create user borg] ********************************************************
changed: [borgs]

TASK [format disk sdc] *********************************************************
changed: [borgs]

TASK [mount disk sdc to /var/backup] *******************************************
changed: [borgs]

TASK [check mount disk lsblk] **************************************************
changed: [borgs]

TASK [debug] *******************************************************************
ok: [borgs] => {
    "results.stdout_lines": [
        "NAME   FSTYPE   FSVER            LABEL           UUID                                 FSAVAIL FSUSE% MOUNTPOINTS",
        "loop0  squashfs 4.0                                                                         0   100% /snap/core20/2318",
        "loop1  squashfs 4.0                                                                         0   100% /snap/lxd/29351",
        "loop2  squashfs 4.0                                                                         0   100% /snap/snapd/21759",
        "sda                                                                                                  ",
        "└─sda1 ext4     1.0              cloudimg-rootfs 31e7e3d2-6937-4fdc-9179-5857d3056c87   37.1G     4% /",
        "sdb    iso9660  Joliet Extension cidata          2024-09-12-02-34-39-00                              ",
        "sdc    ext4     1.0                              f557a104-b891-492e-bed4-a2dda83eb28d    1.8G     0% /var/backup"
    ]
}

TASK [check mount disk df -h] **************************************************
changed: [borgs]

TASK [debug] *******************************************************************
ok: [borgs] => {
    "results.stdout_lines": [
        "Filesystem      Size  Used Avail Use% Mounted on",
        "tmpfs           197M  996K  196M   1% /run",
        "/dev/sda1        39G  1.7G   38G   5% /",
        "tmpfs           982M     0  982M   0% /dev/shm",
        "tmpfs           5.0M     0  5.0M   0% /run/lock",
        "tmpfs           197M  4.0K  197M   1% /run/user/1000",
        "/dev/sdc        2.0G   24K  1.8G   1% /var/backup"
    ]
}

TASK [Create dir for backup] ***************************************************
changed: [borgs]

TASK [clean dir old files] *****************************************************
[WARNING]: Consider using the file module with state=absent rather than running
'rm'.  If you need to use command because file is insufficient you can add
'warn: false' to this command task or set 'command_warnings=False' in
ansible.cfg to get rid of this message.
changed: [borgs]

TASK [Creates directory .ssh] **************************************************
changed: [borgs]

TASK [copy ssh-key] ************************************************************
changed: [borgs]

TASK [restart ssh] *************************************************************
changed: [borgs]

PLAY [Install and config borg to client] ***************************************

TASK [Gathering Facts] *********************************************************
ok: [borgc]

TASK [Install borgbackup] ******************************************************
changed: [borgc]

TASK [borg repo inicializate on client] ****************************************
changed: [borgc]

TASK [Copy script file to VM] **************************************************
changed: [borgc] => (item={'src': '../files/borg-backup.service', 'dest': '/etc/systemd/system/borg-backup.service'})
changed: [borgc] => (item={'src': '../files/borg-backup.timer', 'dest': '/etc/systemd/system/borg-backup.timer'})

TASK [Just force systemd to reread configs (2.4 and above)] ********************
ok: [borgc]

TASK [enable borg-backup.timer] ************************************************
changed: [borgc]

TASK [nginx error log configuration] *******************************************
changed: [borgc]

TASK [debug] *******************************************************************
ok: [borgc] => {
    "results.stdout_lines": [
        "NEXT                        LEFT          LAST                        PASSED      UNIT                           ACTIVATES",
        "Wed 2024-10-02 10:24:20 +05 4min 58s left n/a                         n/a         borg-backup.timer              borg-backup.service",
        "Wed 2024-10-02 10:26:53 +05 7min left     n/a                         n/a         systemd-tmpfiles-clean.timer   systemd-tmpfiles-clean.service",
        "Wed 2024-10-02 16:12:33 +05 5h 53min left n/a                         n/a         motd-news.timer                motd-news.service",
        "Thu 2024-10-03 00:00:00 +05 13h left      n/a                         n/a         dpkg-db-backup.timer           dpkg-db-backup.service",
        "Thu 2024-10-03 00:00:00 +05 13h left      n/a                         n/a         logrotate.timer                logrotate.service",
        "Thu 2024-10-03 03:24:52 +05 17h left      n/a                         n/a         apt-daily.timer                apt-daily.service",
        "Thu 2024-10-03 06:08:34 +05 19h left      n/a                         n/a         apt-daily-upgrade.timer        apt-daily-upgrade.service",
        "Thu 2024-10-03 07:24:34 +05 21h left      n/a                         n/a         man-db.timer                   man-db.service",
        "Thu 2024-10-03 10:17:21 +05 23h left      Wed 2024-10-02 10:17:21 +05 2min 0s ago update-notifier-download.timer update-notifier-download.service",
        "Sun 2024-10-06 03:10:13 +05 3 days left   n/a                         n/a         e2scrub_all.timer              e2scrub_all.service",
        "Mon 2024-10-07 00:49:17 +05 4 days left   n/a                         n/a         fstrim.timer                   fstrim.service",
        "Tue 2024-10-08 00:04:18 +05 5 days left   n/a                         n/a         update-notifier-motd.timer     update-notifier-motd.service",
        "n/a                         n/a           n/a                         n/a         apport-autoreport.timer        apport-autoreport.service",
        "n/a                         n/a           n/a                         n/a         snapd.snap-repair.timer        snapd.snap-repair.service",
        "n/a                         n/a           n/a                         n/a         ua-timer.timer                 ua-timer.service",
        "",
        "15 timers listed."
    ]
}

PLAY RECAP *********************************************************************
borgc                      : ok=21   changed=13   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
borgs                      : ok=22   changed=15   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 